name: CI

on:
  pull_request:
    branches: [ main, master ]
  push:
    branches: [ main, master ]

permissions:
  contents: read
  pull-requests: read

jobs:
  validate:
    name: Validate Site
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Check HTML files exist
        run: |
          echo "Checking for required HTML files..."
          required_files=("index.html" "about.html" "governance.html" "treasury.html" "contact.html")
          
          for file in "${required_files[@]}"; do
            if [ ! -f "$file" ]; then
              echo "❌ Missing required file: $file"
              exit 1
            else
              echo "✓ Found: $file"
            fi
          done
      
      - name: Validate HTML syntax
        uses: Cyb3r-Jak3/html5validator-action@v7.2.0
        with:
          root: .
          css: true
      
      - name: Check links
        uses: lycheeverse/lychee-action@v1
        with:
          args: --verbose --no-progress --exclude-mail './**/*.html'
          fail: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Check assets
        run: |
          echo "Checking for asset directories..."
          if [ ! -d "assets" ]; then
            echo "⚠️ Warning: assets directory not found"
          else
            echo "✓ Assets directory exists"
            echo "Asset structure:"
            find assets -type f | head -20
          fi
      
      - name: Build summary
        run: |
          echo "### ✅ Validation Complete" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "All HTML files validated successfully!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Files validated:**" >> $GITHUB_STEP_SUMMARY
          ls -1 *.html | while read file; do
            echo "- $file" >> $GITHUB_STEP_SUMMARY
          done
